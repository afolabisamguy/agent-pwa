<!doctype html>
}


// Redirect to canonical domain when launched as standalone - only if TARGET_DOMAIN set
function ensureCanonicalOnStandalone() {
if (!isInStandaloneMode()) return;
if (!TARGET_DOMAIN) return; // no redirect during testing
try {
const current = window.location.href;
const target = TARGET_DOMAIN.replace(/\/$/, '') + '/';
if (!current.startsWith(target)) {
window.location.replace(target);
}
} catch (e) {
console.warn('canonical redirect failed', e);
}
}


(function branchByPlatform() {
// If already running as an installed app, show app shell and optionally redirect
if (isInStandaloneMode()) {
ensureCanonicalOnStandalone();
document.getElementById('ios-install')?.classList.add('hidden');
document.getElementById('android-redirect')?.classList.add('hidden');
document.getElementById('desktop')?.classList.add('hidden');
document.getElementById('fallback')?.classList.add('hidden');
document.getElementById('app-shell')?.classList.remove('hidden');
return;
}


// Not installed yet
if (isiOS()) {
document.getElementById('ios-install')?.classList.remove('hidden');
return;
}


if (isAndroid()) {
const androidDiv = document.getElementById('android-redirect');
androidDiv?.classList.remove('hidden');
const link = document.getElementById('play-store-link');
link.href = "https://play.google.com/store/apps/details?id=com.myagent.app"; // update package id
setTimeout(() => { window.location.href = link.href; }, 300);
return;
}


if (!isMobile()) {
const desktop = document.getElementById('desktop');
desktop?.classList.remove('hidden');
const qr = document.getElementById('qr-img');
const siteUrl = TARGET_DOMAIN || (window.location.origin + GH_PAGES_BASE);
qr.src = "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" + encodeURIComponent(siteUrl);
qr.onclick = () => window.open(siteUrl, "_blank");
return;
}


document.getElementById('fallback')?.classList.remove('hidden');
})();


// Register service worker if available
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
const swPath = (typeof GH_PAGES_BASE === 'string' && GH_PAGES_BASE && !TARGET_DOMAIN)
? GH_PAGES_BASE + 'sw.js'
: '/sw.js';
navigator.serviceWorker.register(swPath).catch(err => {
console.warn('SW register failed', err);
});
});
}
</script>
</body>
</html>